<html>

<head>
<title>Learning WebGL &mdash; </title>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">

<script type="text/javascript">
    var gl;
    var img;
    var altImg;

    function initGL(canvas) {
        try {
            gl = canvas.getContext("2d");
            gl.viewportWidth = canvas.width;
            gl.viewportHeight = canvas.height;
            gl.clearRect ( 0 , 0 , canvas.width, canvas.height);
        } catch (e) {
        }
        if (!gl) {
            alert("Could not initialise canvas, sorry :-(");
        }
    }


    function drawScene() {
        gl.drawImage(img,0,0,img.width,img.height);
    }

    function showValue(newValue)
    {
        document.getElementById("range").innerHTML=newValue;
        reload();
    }

    function drawRotationNear(imgd) {
        var zeroX = Math.floor(img.width / 2);
        var zeroY = Math.floor(img.height / 2);
        var zerocanx = Math.floor(gl.viewportWidth / 2);
        var zerocany = Math.floor(gl.viewportHeight / 2);

        altImg = gl.getImageData(0,0,gl.viewportWidth,gl.viewportHeight);
        var altpix = altImg.data;

        var pix = imgd.data;
        var imgX, imgY, currY,currX;
        //var theta = Math.PI / 1000;
        var theta = document.getElementById("range").innerHTML;
        theta = (theta - 90) * Math.PI / 180;
        var sinT = Math.sin(theta);
        var cosT = Math.cos(theta);
        var rowSize = gl.viewportHeight;
        var colSize = gl.viewportWidth;

        console.log("sinT", sinT, "cosT", cosT);


        var counter = 0;

        for (var row = 0; row < rowSize; row++) {
            for (var col = 0; col < colSize; col++) {

                currX = row - zerocanx;
                currY = col - zerocany;

                if (sinT < 0.0001 && sinT > -0.0001) {
                    //console.log("sinT == 0");
                    imgX = currX / cosT;
                    imgY = currY / cosT;
                } else if (cosT < 0.0001 && cosT > -0.0001) {
                    //console.log("cosT == 0");
                    imgY = currX / sinT;
                    imgX = (-1) * currY / sinT;
                } else {

                    imgY = ( (currY * cosT) + (currX) *sinT );
                    imgX = (currX - imgY*sinT) /(cosT);
                    //console.log("else",theta,imgX,imgY,sinT,cosT);
                };

                //console.log(zeroX, (zeroX - imgX),zeroY,(zeroY - imgY));


                //Nearest neighbor interpolation
                imgY = Math.round(imgY);
                imgX = Math.round(imgX);

                //console.log(zeroX, (zeroX - imgX),zeroY,(zeroY - imgY));


                if( (zeroY - imgY) >= 0 && (zeroY - imgY) <= img.height && (zeroX - imgX) >= 0 && (zeroX -imgX) <= img.width) {
                    
                    //console.log("I crashed here",row,rowSize,col);
                    // if (counter % 100 == 0) {
                    //     console.log("alt[], pix[], alt len, pix len",row*rowSize+4*col,(zeroY - imgY) * img.height + 4 * (zeroX - imgX), altpix, pix.length);
                    // };
                    // counter++;
                    
                    altpix[4*(row*rowSize + col) ] = pix[4*((zeroY - imgY) * img.height + (imgX - zeroX))];
                    altpix[4*(row*rowSize + col)+1 ] =  pix[4*((zeroY - imgY) * img.height + (imgX - zeroX)) + 1];

                    altpix[4*(row*rowSize + col)+2 ] =  pix[4*((zeroY - imgY) * img.height + (imgX - zeroX)) + 2];

                    altpix[4*(row*rowSize + col)+3 ] =  pix[4*((zeroY - imgY) * img.height + (imgX - zeroX)) + 3];

                };

                // if( row >= 0 && row <= img.width+800 && col >= 0 && col <= img.height) {
                    
                //     //console.log("I crashed here",row,rowSize,col);
                //     // if (counter % 100 == 0) {
                //     //     console.log("alt[], pix[], alt len, pix len",row*rowSize+4*col,(zeroY - imgY) * img.height + 4 * (zeroX - imgX), altpix, pix.length);
                //     // };
                //     // counter++;
                    
                //     altpix[4*(row*rowSize + col) ] = pix[4*(row * img.width + col)];
                //     altpix[4*(row*rowSize + col)+1 ] =  pix[4*(row* img.width + col)+1 ];

                //     altpix[4*(row*rowSize + col)+2 ] =  pix[4*(row* img.width + col)+2 ];

                //     altpix[4*(row*rowSize + col)+3 ] =  pix[4*(row* img.width + col)+3 ];

                // };

            };

        };
        
        gl.putImageData(altImg,0,0);
        //console.log(img);
        //console.log(zerocanx, gl.viewportWidth, gl.viewportWidth / 2, Math.floor(gl.viewportWidth/2th));
        //gl.fillStyle = "rgba(200, 0, 0, 0.5)";
        //gl.fillRect(0, 0, 500, 500);
    }

    function drawRotationLine(imgd) {
        var zeroX = Math.floor(img.width / 2);
        var zeroY = Math.floor(img.height / 2);
        var zerocanx = Math.floor(gl.viewportWidth / 2);
        var zerocany = Math.floor(gl.viewportHeight / 2);

        altImg = gl.getImageData(0,0,gl.viewportWidth,gl.viewportHeight);
        var altpix = altImg.data;

        var pix = imgd.data;
        var imgX, imgY, currY,currX;
        //var theta = Math.PI / 1000;
        var theta = document.getElementById("range").innerHTML;
        theta = (theta - 90) * Math.PI / 180;
        var sinT = Math.sin(theta);
        var cosT = Math.cos(theta);
        var rowSize = gl.viewportHeight;
        var colSize = gl.viewportWidth;

        console.log("sinT", sinT, "cosT", cosT);


        var counter = 0;

        for (var row = 0; row < rowSize; row++) {
            for (var col = 0; col < colSize; col++) {

                currX = row - zerocanx;
                currY = col - zerocany;

                if (sinT < 0.0001 && sinT > -0.0001) {
                    //console.log("sinT == 0");
                    imgX = currX / cosT;
                    imgY = currY / cosT;
                } else if (cosT < 0.0001 && cosT > -0.0001) {
                    //console.log("cosT == 0");
                    imgY = currX / sinT;
                    imgX = (-1) * currY / sinT;
                } else {

                    imgY = ( (currY * cosT) + (currX) *sinT );
                    imgX = (currX - imgY*sinT) /(cosT);
                    //console.log("else",theta,imgX,imgY,sinT,cosT);
                };

                //console.log(zeroX, (zeroX - imgX),zeroY,(zeroY - imgY));


                //Linear Interpolation
                intImgY = Math.round(imgY);
                intImgX = Math.round(imgX);
                scaleA = imgX - intImgX;
                scaleB = imgY - intImgY;
                imgX = intImgX;
                imgY = intImgY;


                //console.log(zeroX, (zeroX - imgX),zeroY,(zeroY - imgY));


                if( (zeroY - imgY) >= 0 && (zeroY - imgY) <= img.height && (zeroX - imgX) >= 0 && (zeroX - imgX) <= img.width) {

                    
                    altpix[4*(row*rowSize + col) ] = pix[4*((zeroY - imgY) * img.height + (imgX - zeroX))];

                    altpix[4*(row*rowSize + col)+1 ] = 
                        (1 - scaleA) * (1 - scaleB) * pix[4*((zeroY - imgY) * img.height + (imgX - zeroX)) + 1] + 
                        (scaleA) * (1 - scaleB) * pix[4*((zeroY - imgY) * img.height + (imgX + 1 - zeroX)) + 1] + 
                        (1 - scaleA) * (scaleB) * pix[4*((zeroY - imgY + 1) * img.height + (imgX - zeroX)) + 1] + 
                        (scaleA) * (scaleB) * pix[4*((zeroY - imgY + 1) * img.height + (imgX + 1 - zeroX)) + 1];

                    altpix[4*(row*rowSize + col)+2 ] =  
                        (1 - scaleA) * (1 - scaleB) * pix[4*((zeroY - imgY) * img.height + (imgX - zeroX)) + 2] + 
                        (scaleA) * (1 - scaleB) * pix[4*((zeroY - imgY) * img.height + (imgX + 1 - zeroX)) + 2] + 
                        (1 - scaleA) * (scaleB) * pix[4*((zeroY - imgY + 1) * img.height + (imgX - zeroX)) + 2] + 
                        (scaleA) * (scaleB) * pix[4*((zeroY - imgY + 1) * img.height + (imgX + 1 - zeroX)) + 2];

                    altpix[4*(row*rowSize + col)+3 ] =  
                        (1 - scaleA) * (1 - scaleB) * pix[4*((zeroY - imgY) * img.height + (imgX - zeroX)) + 3] + 
                        (scaleA) * (1 - scaleB) * pix[4*((zeroY - imgY) * img.height + (imgX + 1 - zeroX)) + 3] + 
                        (1 - scaleA) * (scaleB) * pix[4*((zeroY - imgY + 1) * img.height + (imgX - zeroX)) + 3] + 
                        (scaleA) * (scaleB) * pix[4*((zeroY - imgY + 1) * img.height + (imgX + 1 - zeroX)) + 3];

                };

            };

        };
        
        gl.putImageData(altImg,0,0);

    }

    function getMaxSobel(h1,h2,h3,h4,h5,h6,h7,h8)
    {
        var val = [255,255,255,255];
        var max = h8[0] + h8[1] +h8[2];
        var temp = h1[0] + h1[1] + h1[2];
        if (temp > max) {
            max = temp;
            val = [230,230,230,255];
        }
        temp = h2[0] + h2[1] + h2[2];
        if (temp > max) {
            max = temp;
            val = [200,200,200,255];
        }
        temp = h3[0] + h3[1] + h3[2];
        if (temp > max) {
            max = temp;
            val = [170,170,170,255];
        }
        temp = h4[0] + h4[1] + h4[2];
        if (temp > max) {
            max = temp;
            val = [140,140,140,255];
        }
        temp = h5[0] + h5[1] + h5[2];
        if (temp > max) {
            max = temp;
            val = [110,110,110,255];
        }
        temp = h6[0] + h6[1] + h6[2];
        if (temp > max) {
            max = temp;
            val = [80,80,80,255];
        }
        temp = h7[0] + h7[1] + h7[2];
        if (temp > max) {
            max = temp;
            val = [50,50,50,255];
        }
        if (max < 1) {
            val = [0,0,0,255];
        };
        return val;

    }

    function SobelOp(imgd)
    {
        var zeroX = Math.floor(img.width / 2);
        var zeroY = Math.floor(img.height / 2);
        var zerocanx = Math.floor(gl.viewportWidth / 2);
        var zerocany = Math.floor(gl.viewportHeight / 2);

        altImg = gl.getImageData(0,0,gl.viewportWidth,gl.viewportHeight);
        var altpix = altImg.data;

        var pix = imgd.data;
        var currY,currX;

        var rowSize = gl.viewportHeight;
        var colSize = gl.viewportWidth;

        var h1 = [], h2 = [], h3 = [], h4 = [], h5 = [], h6 = [], h7 = [], h8 = [], val = [];

        for (var row = 1; row < rowSize - 1; row++) {
            for (var col = 1; col < colSize - 1; col++) {


                if( row >= 1 && row <= img.width - 1 && col >= 1 && col <= img.height -1) {

                    h1[0] = pix[4*((row - 1)* img.width + col-1)+0 ];
                    h1[1] = pix[4*((row - 1)* img.width + col-1)+1 ];
                    h1[2] = pix[4*((row - 1)* img.width + col-1)+2 ];
                    //h1[3] = pix[4*((row - 1)* img.width + col-1)+3 ];

                    h1[0] += 2*pix[4*((row - 1)* img.width + col-0)+0 ];
                    h1[1] += 2*pix[4*((row - 1)* img.width + col-0)+1 ];
                    h1[2] += 2*pix[4*((row - 1)* img.width + col-0)+2 ];
                    //h1[3] += pix[4*((row - 1)* img.width + col-0)+3 ];

                    h1[0] += pix[4*((row - 1)* img.width + col+1)+0 ];
                    h1[1] += pix[4*((row - 1)* img.width + col+1)+1 ];
                    h1[2] += pix[4*((row - 1)* img.width + col+1)+2 ];
                    //h1[3] += pix[4*((row - 1)* img.width + col+1)+3 ];
                    
                    h1[0] -= pix[4*((row + 1)* img.width + col-1)+0 ];
                    h1[1] -= pix[4*((row + 1)* img.width + col-1)+1 ];
                    h1[2] -= pix[4*((row + 1)* img.width + col-1)+2 ];
                    //h1[3] -= pix[4*((row + 1)* img.width + col-1)+3 ];
                    
                    h1[0] -= 2*pix[4*((row + 1)* img.width + col-0)+0 ];
                    h1[1] -= 2*pix[4*((row + 1)* img.width + col-0)+1 ];
                    h1[2] -= 2*pix[4*((row + 1)* img.width + col-0)+2 ];
                    //h1[3] -= pix[4*((row + 1)* img.width + col-0)+3 ];
                    
                    h1[0] -= pix[4*((row + 1)* img.width + col+1)+0 ];
                    h1[1] -= pix[4*((row + 1)* img.width + col+1)+1 ];
                    h1[2] -= pix[4*((row + 1)* img.width + col+1)+2 ];
                    //h1[3] -= pix[4*((row + 1)* img.width + col+1)+3 ];
                    
                    //Second Sobel Operator
                    h2[0] = pix[4*((row - 1)* img.width + col-0)+0 ];
                    h2[1] = pix[4*((row - 1)* img.width + col-0)+1 ];
                    h2[2] = pix[4*((row - 1)* img.width + col-0)+2 ];
                    //h1[3] = pix[4*((row - 1)* img.width + col-1)+3 ];
                    
                    h2[0] += 2*pix[4*((row - 1)* img.width + col+1)+0 ];
                    h2[1] += 2*pix[4*((row - 1)* img.width + col+1)+1 ];
                    h2[2] += 2*pix[4*((row - 1)* img.width + col+1)+2 ];
                    //h1[3] += pix[4*((row - 1)* img.width + col-0)+3 ];
                    
                    h2[0] += pix[4*((row - 0)* img.width + col+0)+0 ];
                    h2[1] += pix[4*((row - 0)* img.width + col+0)+1 ];
                    h2[2] += pix[4*((row - 0)* img.width + col+0)+2 ];
                    //h1[3] += pix[4*((row - 1)* img.width + col+1)+3 ];
                    
                    h2[0] -= pix[4*((row + 1)* img.width + col-0)+0 ];
                    h2[1] -= pix[4*((row + 1)* img.width + col-0)+1 ];
                    h2[2] -= pix[4*((row + 1)* img.width + col-0)+2 ];
                    //h1[3] -= pix[4*((row + 1)* img.width + col-1)+3 ];
                    
                    h2[0] -= 2*pix[4*((row + 1)* img.width + col-1)+0 ];
                    h2[1] -= 2*pix[4*((row + 1)* img.width + col-1)+1 ];
                    h2[2] -= 2*pix[4*((row + 1)* img.width + col-1)+2 ];
                    //h1[3] -= pix[4*((row + 1)* img.width + col-0)+3 ];
                    
                    h2[0] -= pix[4*((row + 0)* img.width + col-1)+0 ];
                    h2[1] -= pix[4*((row + 0)* img.width + col-1)+1 ];
                    h2[2] -= pix[4*((row + 0)* img.width + col-1)+2 ];
                    //h1[3] -= pix[4*((row + 1)* img.width + col+1)+3 ];
                    
                    //Third Sobel Operator
                    h3[0] = pix[4*((row - 1)* img.width + col+1)+0 ];
                    h3[1] = pix[4*((row - 1)* img.width + col+1)+1 ];
                    h3[2] = pix[4*((row - 1)* img.width + col+1)+2 ];
                    
                    h3[0] += 2*pix[4*((row - 0)* img.width + col+1)+0 ];
                    h3[1] += 2*pix[4*((row - 0)* img.width + col+1)+1 ];
                    h3[2] += 2*pix[4*((row - 0)* img.width + col+1)+2 ];
                    
                    h3[0] += pix[4*((row + 1)* img.width + col+1)+0 ];
                    h3[1] += pix[4*((row + 1)* img.width + col+1)+1 ];
                    h3[2] += pix[4*((row + 1)* img.width + col+1)+2 ];
                    
                    h3[0] -= pix[4*((row - 1)* img.width + col-1)+0 ];
                    h3[1] -= pix[4*((row - 1)* img.width + col-1)+1 ];
                    h3[2] -= pix[4*((row - 1)* img.width + col-1)+2 ];
                    
                    h3[0] -= 2*pix[4*((row + 0)* img.width + col-1)+0 ];
                    h3[1] -= 2*pix[4*((row + 0)* img.width + col-1)+1 ];
                    h3[2] -= 2*pix[4*((row + 0)* img.width + col-1)+2 ];
                    
                    h3[0] -= pix[4*((row + 1)* img.width + col-1)+0 ];
                    h3[1] -= pix[4*((row + 1)* img.width + col-1)+1 ];
                    h3[2] -= pix[4*((row + 1)* img.width + col-1)+2 ];
                    
                    //Fourth Sobel
                    h4[0] = pix[4*((row - 0)* img.width + col+1)+0 ];
                    h4[1] = pix[4*((row - 0)* img.width + col+1)+1 ];
                    h4[2] = pix[4*((row - 0)* img.width + col+1)+2 ];
                    //h1[3] = pix[4*((row - 1)* img.width + col-1)+3 ];
                    
                    h4[0] += 2*pix[4*((row + 1)* img.width + col+1)+0 ];
                    h4[1] += 2*pix[4*((row + 1)* img.width + col+1)+1 ];
                    h4[2] += 2*pix[4*((row + 1)* img.width + col+1)+2 ];
                    //h1[3] += pix[4*((row - 1)* img.width + col-0)+3 ];
                    
                    h4[0] += pix[4*((row + 1)* img.width + col+0)+0 ];
                    h4[1] += pix[4*((row + 1)* img.width + col+0)+1 ];
                    h4[2] += pix[4*((row + 1)* img.width + col+0)+2 ];
                    //h1[3] += pix[4*((row - 1)* img.width + col+1)+3 ];
                    
                    h4[0] -= pix[4*((row - 0)* img.width + col-1)+0 ];
                    h4[1] -= pix[4*((row - 0)* img.width + col-1)+1 ];
                    h4[2] -= pix[4*((row - 0)* img.width + col-1)+2 ];
                    //h1[3] -= pix[4*((row + 1)* img.width + col-1)+3 ];
                    
                    h4[0] -= 2*pix[4*((row - 1)* img.width + col-1)+0 ];
                    h4[1] -= 2*pix[4*((row - 1)* img.width + col-1)+1 ];
                    h4[2] -= 2*pix[4*((row - 1)* img.width + col-1)+2 ];
                    //h1[3] -= pix[4*((row + 1)* img.width + col-0)+3 ];
                    
                    h4[0] -= pix[4*((row - 1)* img.width + col+0)+0 ];
                    h4[1] -= pix[4*((row - 1)* img.width + col+0)+1 ];
                    h4[2] -= pix[4*((row - 1)* img.width + col+0)+2 ];
                    //h1[3] -= pix[4*((row + 1)* img.width + col+1)+3 ];

                    //Fifth Sobel
                    h5[0] = pix[4*((row + 1)* img.width + col-1)+0 ];
                    h5[1] = pix[4*((row + 1)* img.width + col-1)+1 ];
                    h5[2] = pix[4*((row + 1)* img.width + col-1)+2 ];

                    h5[0] += 2*pix[4*((row + 1)* img.width + col-0)+0 ];
                    h5[1] += 2*pix[4*((row + 1)* img.width + col-0)+1 ];
                    h5[2] += 2*pix[4*((row + 1)* img.width + col-0)+2 ];
                    
                    h5[0] += pix[4*((row + 1)* img.width + col+1)+0 ];
                    h5[1] += pix[4*((row + 1)* img.width + col+1)+1 ];
                    h5[2] += pix[4*((row + 1)* img.width + col+1)+2 ];
                    
                    h5[0] -= pix[4*((row - 1)* img.width + col-1)+0 ];
                    h5[1] -= pix[4*((row - 1)* img.width + col-1)+1 ];
                    h5[2] -= pix[4*((row - 1)* img.width + col-1)+2 ];
                    
                    h5[0] -= 2*pix[4*((row - 1)* img.width + col-0)+0 ];
                    h5[1] -= 2*pix[4*((row - 1)* img.width + col-0)+1 ];
                    h5[2] -= 2*pix[4*((row - 1)* img.width + col-0)+2 ];
                    
                    h5[0] -= pix[4*((row - 1)* img.width + col+1)+0 ];
                    h5[1] -= pix[4*((row - 1)* img.width + col+1)+1 ];
                    h5[2] -= pix[4*((row - 1)* img.width + col+1)+2 ];
                    
                    //Sixth Sobel
                    h6[0] = pix[4*((row + 1)* img.width + col-0)+0 ];
                    h6[1] = pix[4*((row + 1)* img.width + col-0)+1 ];
                    h6[2] = pix[4*((row + 1)* img.width + col-0)+2 ];
                    
                    h6[0] += 2*pix[4*((row + 1)* img.width + col-1)+0 ];
                    h6[1] += 2*pix[4*((row + 1)* img.width + col-1)+1 ];
                    h6[2] += 2*pix[4*((row + 1)* img.width + col-1)+2 ];
                    
                    h6[0] += pix[4*((row - 0)* img.width + col-1)+0 ];
                    h6[1] += pix[4*((row - 0)* img.width + col-1)+1 ];
                    h6[2] += pix[4*((row - 0)* img.width + col-1)+2 ];
                    
                    h6[0] -= pix[4*((row - 1)* img.width + col-0)+0 ];
                    h6[1] -= pix[4*((row - 1)* img.width + col-0)+1 ];
                    h6[2] -= pix[4*((row - 1)* img.width + col-0)+2 ];
                    
                    h6[0] -= 2*pix[4*((row - 1)* img.width + col+1)+0 ];
                    h6[1] -= 2*pix[4*((row - 1)* img.width + col+1)+1 ];
                    h6[2] -= 2*pix[4*((row - 1)* img.width + col+1)+2 ];
                    
                    h6[0] -= pix[4*((row + 0)* img.width + col+1)+0 ];
                    h6[1] -= pix[4*((row + 0)* img.width + col+1)+1 ];
                    h6[2] -= pix[4*((row + 0)* img.width + col+1)+2 ];
                    
                    //Seventh Sobel
                    h7[0] = pix[4*((row - 1)* img.width + col-1)+0 ];
                    h7[1] = pix[4*((row - 1)* img.width + col-1)+1 ];
                    h7[2] = pix[4*((row - 1)* img.width + col-1)+2 ];
                    
                    h7[0] += 2*pix[4*((row - 0)* img.width + col-1)+0 ];
                    h7[1] += 2*pix[4*((row - 0)* img.width + col-1)+1 ];
                    h7[2] += 2*pix[4*((row - 0)* img.width + col-1)+2 ];
                    
                    h7[0] += pix[4*((row + 1)* img.width + col-1)+0 ];
                    h7[1] += pix[4*((row + 1)* img.width + col-1)+1 ];
                    h7[2] += pix[4*((row + 1)* img.width + col-1)+2 ];
                    
                    h7[0] -= pix[4*((row - 1)* img.width + col+1)+0 ];
                    h7[1] -= pix[4*((row - 1)* img.width + col+1)+1 ];
                    h7[2] -= pix[4*((row - 1)* img.width + col+1)+2 ];
                    
                    h7[0] -= 2*pix[4*((row + 0)* img.width + col+1)+0 ];
                    h7[1] -= 2*pix[4*((row + 0)* img.width + col+1)+1 ];
                    h7[2] -= 2*pix[4*((row + 0)* img.width + col+1)+2 ];
                    
                    h7[0] -= pix[4*((row + 1)* img.width + col+1)+0 ];
                    h7[1] -= pix[4*((row + 1)* img.width + col+1)+1 ];
                    h7[2] -= pix[4*((row + 1)* img.width + col+1)+2 ];
                    
                    //Eigth Sobel
                    h8[0] = pix[4*((row - 0)* img.width + col-1)+0 ];
                    h8[1] = pix[4*((row - 0)* img.width + col-1)+1 ];
                    h8[2] = pix[4*((row - 0)* img.width + col-1)+2 ];
                    
                    h8[0] += 2*pix[4*((row - 1)* img.width + col-1)+0 ];
                    h8[1] += 2*pix[4*((row - 1)* img.width + col-1)+1 ];
                    h8[2] += 2*pix[4*((row - 1)* img.width + col-1)+2 ];
                    
                    h8[0] += pix[4*((row - 1)* img.width + col+0)+0 ];
                    h8[1] += pix[4*((row - 1)* img.width + col+0)+1 ];
                    h8[2] += pix[4*((row - 1)* img.width + col+0)+2 ];
                    
                    h8[0] -= pix[4*((row + 0)* img.width + col+1)+0 ];
                    h8[1] -= pix[4*((row + 0)* img.width + col+1)+1 ];
                    h8[2] -= pix[4*((row + 0)* img.width + col+1)+2 ];
                    
                    h8[0] -= 2*pix[4*((row + 1)* img.width + col+1)+0 ];
                    h8[1] -= 2*pix[4*((row + 1)* img.width + col+1)+1 ];
                    h8[2] -= 2*pix[4*((row + 1)* img.width + col+1)+2 ];
                    
                    h8[0] -= pix[4*((row + 1)* img.width + col+0)+0 ];
                    h8[1] -= pix[4*((row + 1)* img.width + col+0)+1 ];
                    h8[2] -= pix[4*((row + 1)* img.width + col+0)+2 ];


                    val = getMaxSobel(h1,h2,h3,h4,h5,h6,h7,h8);


                    // val[0] = Math.sqrt(h1[0] * h1[0] + h3[0] * h3[0]);
                    // val[1] = Math.sqrt(h1[1] * h1[1] + h3[1] * h3[1]);
                    // val[2] = Math.sqrt(h1[2] * h1[2] + h3[2] * h3[2]);
                    // val[3] = 255;

                    altpix[4*(row*rowSize + col) ] = val[0];
                    altpix[4*(row*rowSize + col)+1 ] =  val[1];
                    altpix[4*(row*rowSize + col)+2 ] =  val[2];
                    altpix[4*(row*rowSize + col)+3 ] =  val[3];


                };

                // if( row >= 0 && row <= img.width+800 && col >= 0 && col <= img.height) {
                    
                //     altpix[4*(row*rowSize + col) ] = pix[4*(row * img.width + col)];
                //     altpix[4*(row*rowSize + col)+1 ] =  pix[4*(row* img.width + col)+1 ];

                //     altpix[4*(row*rowSize + col)+2 ] =  pix[4*(row* img.width + col)+2 ];

                //     altpix[4*(row*rowSize + col)+3 ] =  pix[4*(row* img.width + col)+3 ];
                //     console.log(pix[4*(row* img.width + col)+3]);

                // };

            };

        };
        
        gl.putImageData(altImg,zerocanx / 2, zerocany / 2);
        //console.log(img);
        //console.log(zerocanx, gl.viewportWidth, gl.viewportWidth / 2, Math.floor(gl.viewportWidth/2th));
        //gl.fillStyle = "rgba(200, 0, 0, 0.5)";
        //gl.fillRect(0, 0, 500, 500);
    }


    function reload() {
        var canvas0 = document.getElementById("canvas0");
        var canvas1 = document.getElementById("canvas1");
        var canvas2 = document.getElementById("canvas2");
        var imgd;
        ctx0 = canvas0.getContext("2d");
        imgd = ctx0.getImageData(0,0,canvas0.width,canvas0.height);
        initGL(canvas1);
        drawRotationNear(imgd);
        initGL(canvas2);
        drawRotationLine(imgd);
    }

    function webGLStart() {
        var canvas0 = document.getElementById("canvas0");
        var canvas1 = document.getElementById("canvas1");
        var canvas2 = document.getElementById("canvas2");
        var canvas3 = document.getElementById("canvas3");
        img = new Image();
        img.src = "figure_problem_set_2.png";
        initGL(canvas0);
        var imgd;
        img.onload = function() {
            canvas0.width = img.width;
            canvas0.height = img.height;
            drawScene(img);
            imgd = gl.getImageData(0,0,canvas0.width,canvas0.height);
            initGL(canvas1);
            drawRotationNear(imgd);
            initGL(canvas2);
            drawRotationLine(imgd);
            initGL(canvas3);
            SobelOp(imgd);
        }
    }
</script>


</head>


<body onload="webGLStart();">
    <p>Image to Use: </p>

    <!--<img id="img" src="figure_problem_set_2.png" alt="lungs" width="220" height="277"-->

    <canvas id="canvas0" style="border: 1px solid #000000; margin-left: auto; margin-right: auto; display: block;" width="500" height="500"></canvas>

    <p>Select rotation:</p>
    <input style="padding-left=100px" type="range" min="-180" max="180" value="0" step="1" onchange="showValue(this.value)" />
    <span id="range">0</span>

    <p>Nearest Neighbor Interpolated Image:</p>

    <canvas id="canvas1" style="border: 1px solid #000000; margin-left: auto; margin-right: auto; display: block;" width="500" height="500"></canvas>

    <button onclick="onOff0()">Show relevant JS code</button>
    <script type="text/javascript">
    function onOff0() {
    var onOff = document.getElementById("item0").style.display;
    if (onOff == "none") {
        document.getElementById("item0").style.display="block";
    } else{
        document.getElementById("item0").style.display="none";
    };
    };
    </script>

        <pre id="item0" style="display:none;">
        Javascript Code:
        <code>
    function drawRotationNear(imgd) {
        var zeroX = Math.floor(img.width / 2);
        var zeroY = Math.floor(img.height / 2);
        var zerocanx = Math.floor(gl.viewportWidth / 2);
        var zerocany = Math.floor(gl.viewportHeight / 2);

        altImg = gl.getImageData(0,0,gl.viewportWidth,gl.viewportHeight);
        var altpix = altImg.data;

        var pix = imgd.data;
        var imgX, imgY, currY,currX;
        var theta = document.getElementById("range").innerHTML;
        theta = (theta - 90) * Math.PI / 180;
        var sinT = Math.sin(theta);
        var cosT = Math.cos(theta);
        var rowSize = gl.viewportHeight;
        var colSize = gl.viewportWidth;

        console.log("sinT", sinT, "cosT", cosT);


        var counter = 0;

        for (var row = 0; row &lt; rowSize; row++) {
            for (var col = 0; col &lt; colSize; col++) {

                currX = row - zerocanx;
                currY = col - zerocany;

                if (sinT &lt; 0.0001 &amp;&amp; sinT > -0.0001) {
                    //console.log("sinT == 0");
                    imgX = currX / cosT;
                    imgY = currY / cosT;
                } else if (cosT &lt; 0.0001 &amp;&amp; cosT > -0.0001) {
                    //console.log("cosT == 0");
                    imgY = currX / sinT;
                    imgX = (-1) * currY / sinT;
                } else {

                    imgY = ( (currY * cosT) + (currX) *sinT );
                    imgX = (currX - imgY*sinT) /(cosT);
                    //console.log("else",theta,imgX,imgY,sinT,cosT);
                };

                //console.log(zeroX, (zeroX - imgX),zeroY,(zeroY - imgY));


                //Nearest neighbor interpolation
                imgY = Math.round(imgY);
                imgX = Math.round(imgX);

                //console.log(zeroX, (zeroX - imgX),zeroY,(zeroY - imgY));


                if( (zeroY - imgY) >= 0 &amp;&amp; (zeroY - imgY) &lt;= img.height &amp;&amp; (zeroX - imgX) >= 0 &amp;&amp; (zeroX -imgX) &lt;= img.width) {
                    
                    altpix[4*(row*rowSize + col) ] = pix[4*((zeroY - imgY) * img.height + (imgX - zeroX))];
                    altpix[4*(row*rowSize + col)+1 ] =  pix[4*((zeroY - imgY) * img.height + (imgX - zeroX)) + 1];

                    altpix[4*(row*rowSize + col)+2 ] =  pix[4*((zeroY - imgY) * img.height + (imgX - zeroX)) + 2];

                    altpix[4*(row*rowSize + col)+3 ] =  pix[4*((zeroY - imgY) * img.height + (imgX - zeroX)) + 3];

                };

            };

        };
        
        gl.putImageData(altImg,0,0);
    }
    </code>
    </pre>

    <p>Linear Interpolated Image:</p>

    <canvas id="canvas2" style="border: 1px solid #000000; margin-left: auto; margin-right: auto; display: block;" width="500" height="500"></canvas>

    <button onclick="onOff1()">Show relevant JS code</button>
    <script type="text/javascript">
    function onOff1() {
    var onOff = document.getElementById("item1").style.display;
    if (onOff == "none") {
        document.getElementById("item1").style.display="block";
    } else{
        document.getElementById("item1").style.display="none";
    };
    };
    </script>

    <pre id="item1" style="display:none;">
    <code>
    Javascript Code: 
    function drawRotationNear(imgd) {
        var zeroX = Math.floor(img.width / 2);
        var zeroY = Math.floor(img.height / 2);
        var zerocanx = Math.floor(gl.viewportWidth / 2);
        var zerocany = Math.floor(gl.viewportHeight / 2);

        altImg = gl.getImageData(0,0,gl.viewportWidth,gl.viewportHeight);
        var altpix = altImg.data;

        var pix = imgd.data;
        var imgX, imgY, currY,currX;
        //var theta = Math.PI / 1000;
        var theta = document.getElementById("range").innerHTML;
        theta = (theta - 90) * Math.PI / 180;
        var sinT = Math.sin(theta);
        var cosT = Math.cos(theta);
        var rowSize = gl.viewportHeight;
        var colSize = gl.viewportWidth;

        console.log("sinT", sinT, "cosT", cosT);


        var counter = 0;

        for (var row = 0; row &lt; rowSize; row++) {
            for (var col = 0; col &lt; colSize; col++) {

                currX = row - zerocanx;
                currY = col - zerocany;

                if (sinT &lt; 0.0001 &amp;&amp; sinT > -0.0001) {
                    //console.log("sinT == 0");
                    imgX = currX / cosT;
                    imgY = currY / cosT;
                } else if (cosT &lt; 0.0001 &amp;&amp; cosT > -0.0001) {
                    //console.log("cosT == 0");
                    imgY = currX / sinT;
                    imgX = (-1) * currY / sinT;
                } else {

                    imgY = ( (currY * cosT) + (currX) *sinT );
                    imgX = (currX - imgY*sinT) /(cosT);
                    //console.log("else",theta,imgX,imgY,sinT,cosT);
                };

                //console.log(zeroX, (zeroX - imgX),zeroY,(zeroY - imgY));


                //Nearest neighbor interpolation
                imgY = Math.round(imgY);
                imgX = Math.round(imgX);

                //console.log(zeroX, (zeroX - imgX),zeroY,(zeroY - imgY));


                if( (zeroY - imgY) >= 0 &amp;&amp; (zeroY - imgY) &lt;= img.height &amp;&amp; (zeroX - imgX) >= 0 &amp;&amp; (zeroX -imgX) &lt;= img.width) {
                    
                    altpix[4*(row*rowSize + col) ] = pix[4*((zeroY - imgY) * img.height + (imgX - zeroX))];
                    altpix[4*(row*rowSize + col)+1 ] =  pix[4*((zeroY - imgY) * img.height + (imgX - zeroX)) + 1];

                    altpix[4*(row*rowSize + col)+2 ] =  pix[4*((zeroY - imgY) * img.height + (imgX - zeroX)) + 2];

                    altpix[4*(row*rowSize + col)+3 ] =  pix[4*((zeroY - imgY) * img.height + (imgX - zeroX)) + 3];

                };

            };

        };
        
        gl.putImageData(altImg,0,0);
    }
    </code>
    </pre>


    <p>Comments on the differences between approaches: Since the linear interpolation interpolates the pixels in the rotated image, the resulting image has more blending along the edges than the nearest neighbor interpolation.</p>


    <p>Edge Enhancement Image (via Sobel Operator):</p>

    <canvas id="canvas3" style="border: 1px solid #000000; margin-left: auto; margin-right: auto; display: block;" width="500" height="500"></canvas>

    <p>The output image is oriented with the brightest direction going up-left and decreasing magnitude as one goes clockwise.  The output image highlights different edges that appear with varying colors.</p>

    <button onclick="onOff2()">Show relevant JS code</button>
    <script type="text/javascript">
    function onOff2() {
    var onOff = document.getElementById("item2").style.display;
    if (onOff == "none") {
        document.getElementById("item2").style.display="block";
    } else{
        document.getElementById("item2").style.display="none";
    };
    };
    </script>

    <pre id="item2" style="display:none;">
    <code>
        Javascript Code:

            function getMaxSobel(h1,h2,h3,h4,h5,h6,h7,h8)
    {
        var val = [255,255,255,255];
        var max = h8[0] + h8[1] +h8[2];
        var temp = h1[0] + h1[1] + h1[2];
        if (temp > max) {
            max = temp;
            val = [230,230,230,255];
        }
        temp = h2[0] + h2[1] + h2[2];
        if (temp > max) {
            max = temp;
            val = [200,200,200,255];
        }
        temp = h3[0] + h3[1] + h3[2];
        if (temp > max) {
            max = temp;
            val = [170,170,170,255];
        }
        temp = h4[0] + h4[1] + h4[2];
        if (temp > max) {
            max = temp;
            val = [140,140,140,255];
        }
        temp = h5[0] + h5[1] + h5[2];
        if (temp > max) {
            max = temp;
            val = [110,110,110,255];
        }
        temp = h6[0] + h6[1] + h6[2];
        if (temp > max) {
            max = temp;
            val = [80,80,80,255];
        }
        temp = h7[0] + h7[1] + h7[2];
        if (temp > max) {
            max = temp;
            val = [50,50,50,255];
        }
        if (max &lt; 1) {
            val = [0,0,0,255];
        };
        return val;

    }

    function SobelOp(imgd)
    {
        var zeroX = Math.floor(img.width / 2);
        var zeroY = Math.floor(img.height / 2);
        var zerocanx = Math.floor(gl.viewportWidth / 2);
        var zerocany = Math.floor(gl.viewportHeight / 2);

        altImg = gl.getImageData(0,0,gl.viewportWidth,gl.viewportHeight);
        var altpix = altImg.data;

        var pix = imgd.data;
        var currY,currX;

        var rowSize = gl.viewportHeight;
        var colSize = gl.viewportWidth;

        var h1 = [], h2 = [], h3 = [], h4 = [], h5 = [], h6 = [], h7 = [], h8 = [], val = [];

        for (var row = 1; row &lt; rowSize - 1; row++) {
            for (var col = 1; col &lt; colSize - 1; col++) {


                if( row >= 1 &amp;&amp; row &lt;= img.width - 1 &amp;&amp; col >= 1 &amp;&amp; col &lt;= img.height -1) {

                    h1[0] = 0.5*pix[4*((row - 1)* img.width + col-1)+0 ];
                    h1[1] = 0.5*pix[4*((row - 1)* img.width + col-1)+1 ];
                    h1[2] = 0.5*pix[4*((row - 1)* img.width + col-1)+2 ];
                    //h1[3] = pix[4*((row - 1)* img.width + col-1)+3 ];

                    h1[0] += 1*pix[4*((row - 1)* img.width + col-0)+0 ];
                    h1[1] += 1*pix[4*((row - 1)* img.width + col-0)+1 ];
                    h1[2] += 1*pix[4*((row - 1)* img.width + col-0)+2 ];
                    //h1[3] += pix[4*((row - 1)* img.width + col-0)+3 ];

                    h1[0] += 0.5*pix[4*((row - 1)* img.width + col+1)+0 ];
                    h1[1] += 0.5*pix[4*((row - 1)* img.width + col+1)+1 ];
                    h1[2] += 0.5*pix[4*((row - 1)* img.width + col+1)+2 ];
                    //h1[3] += pix[4*((row - 1)* img.width + col+1)+3 ];

                    h1[0] -= 0.5*pix[4*((row + 1)* img.width + col-1)+0 ];
                    h1[1] -= 0.5*pix[4*((row + 1)* img.width + col-1)+1 ];
                    h1[2] -= 0.5*pix[4*((row + 1)* img.width + col-1)+2 ];
                    //h1[3] -= pix[4*((row + 1)* img.width + col-1)+3 ];

                    h1[0] -= 1*pix[4*((row + 1)* img.width + col-0)+0 ];
                    h1[1] -= 1*pix[4*((row + 1)* img.width + col-0)+1 ];
                    h1[2] -= 1*pix[4*((row + 1)* img.width + col-0)+2 ];
                    //h1[3] -= pix[4*((row + 1)* img.width + col-0)+3 ];

                    h1[0] -= 0.5*pix[4*((row + 1)* img.width + col+1)+0 ];
                    h1[1] -= 0.5*pix[4*((row + 1)* img.width + col+1)+1 ];
                    h1[2] -= 0.5*pix[4*((row + 1)* img.width + col+1)+2 ];
                    //h1[3] -= pix[4*((row + 1)* img.width + col+1)+3 ];


                    //Second Sobel Operator
                    h2[0] = 0.5*pix[4*((row - 1)* img.width + col-0)+0 ];
                    h2[1] = 0.5*pix[4*((row - 1)* img.width + col-0)+1 ];
                    h2[2] = 0.5*pix[4*((row - 1)* img.width + col-0)+2 ];
                    //h1[3] = pix[4*((row - 1)* img.width + col-1)+3 ];

                    h2[0] += 1*pix[4*((row - 1)* img.width + col+1)+0 ];
                    h2[1] += 1*pix[4*((row - 1)* img.width + col+1)+1 ];
                    h2[2] += 1*pix[4*((row - 1)* img.width + col+1)+2 ];
                    //h1[3] += pix[4*((row - 1)* img.width + col-0)+3 ];

                    h2[0] += 0.5*pix[4*((row - 0)* img.width + col+0)+0 ];
                    h2[1] += 0.5*pix[4*((row - 0)* img.width + col+0)+1 ];
                    h2[2] += 0.5*pix[4*((row - 0)* img.width + col+0)+2 ];
                    //h1[3] += pix[4*((row - 1)* img.width + col+1)+3 ];

                    h2[0] -= 0.5*pix[4*((row + 1)* img.width + col-0)+0 ];
                    h2[1] -= 0.5*pix[4*((row + 1)* img.width + col-0)+1 ];
                    h2[2] -= 0.5*pix[4*((row + 1)* img.width + col-0)+2 ];
                    //h1[3] -= pix[4*((row + 1)* img.width + col-1)+3 ];

                    h2[0] -= 1*pix[4*((row + 1)* img.width + col-1)+0 ];
                    h2[1] -= 1*pix[4*((row + 1)* img.width + col-1)+1 ];
                    h2[2] -= 1*pix[4*((row + 1)* img.width + col-1)+2 ];
                    //h1[3] -= pix[4*((row + 1)* img.width + col-0)+3 ];

                    h2[0] -= 0.5*pix[4*((row + 0)* img.width + col-1)+0 ];
                    h2[1] -= 0.5*pix[4*((row + 0)* img.width + col-1)+1 ];
                    h2[2] -= 0.5*pix[4*((row + 0)* img.width + col-1)+2 ];
                    //h1[3] -= pix[4*((row + 1)* img.width + col+1)+3 ];



                    //Third Sobel Operator
                    h3[0] = 0.5*pix[4*((row - 1)* img.width + col+1)+0 ];
                    h3[1] = 0.5*pix[4*((row - 1)* img.width + col+1)+1 ];
                    h3[2] = 0.5*pix[4*((row - 1)* img.width + col+1)+2 ];

                    h3[0] += 1*pix[4*((row - 0)* img.width + col+1)+0 ];
                    h3[1] += 1*pix[4*((row - 0)* img.width + col+1)+1 ];
                    h3[2] += 1*pix[4*((row - 0)* img.width + col+1)+2 ];

                    h3[0] += 0.5*pix[4*((row + 1)* img.width + col+1)+0 ];
                    h3[1] += 0.5*pix[4*((row + 1)* img.width + col+1)+1 ];
                    h3[2] += pix[4*((row + 1)* img.width + col+1)+2 ];

                    h3[0] -= 0.5*pix[4*((row - 1)* img.width + col-1)+0 ];
                    h3[1] -= 0.5*pix[4*((row - 1)* img.width + col-1)+1 ];
                    h3[2] -= 0.5*pix[4*((row - 1)* img.width + col-1)+2 ];

                    h3[0] -= 1*pix[4*((row + 0)* img.width + col-1)+0 ];
                    h3[1] -= 1*pix[4*((row + 0)* img.width + col-1)+1 ];
                    h3[2] -= 1*pix[4*((row + 0)* img.width + col-1)+2 ];

                    h3[0] -= 0.5*pix[4*((row + 1)* img.width + col-1)+0 ];
                    h3[1] -= 0.5*pix[4*((row + 1)* img.width + col-1)+1 ];
                    h3[2] -= 0.5*pix[4*((row + 1)* img.width + col-1)+2 ];


                    //Fourth Sobel
                    h4[0] = 0.5*pix[4*((row - 0)* img.width + col+1)+0 ];
                    h4[1] = 0.5*pix[4*((row - 0)* img.width + col+1)+1 ];
                    h4[2] = 0.5*pix[4*((row - 0)* img.width + col+1)+2 ];
                    //h1[3] = pix[4*((row - 1)* img.width + col-1)+3 ];

                    h4[0] += 1*pix[4*((row + 1)* img.width + col+1)+0 ];
                    h4[1] += 1*pix[4*((row + 1)* img.width + col+1)+1 ];
                    h4[2] += 1*pix[4*((row + 1)* img.width + col+1)+2 ];
                    //h1[3] += pix[4*((row - 1)* img.width + col-0)+3 ];

                    h4[0] += 0.5*pix[4*((row + 1)* img.width + col+0)+0 ];
                    h4[1] += 0.5*pix[4*((row + 1)* img.width + col+0)+1 ];
                    h4[2] += 0.5*pix[4*((row + 1)* img.width + col+0)+2 ];

                    h4[0] -= 0.5*pix[4*((row - 0)* img.width + col-1)+0 ];
                    h4[1] -= 0.5*pix[4*((row - 0)* img.width + col-1)+1 ];
                    h4[2] -= 0.5*pix[4*((row - 0)* img.width + col-1)+2 ];

                    h4[0] -= 1*pix[4*((row - 1)* img.width + col-1)+0 ];
                    h4[1] -= 1*pix[4*((row - 1)* img.width + col-1)+1 ];
                    h4[2] -= 1*pix[4*((row - 1)* img.width + col-1)+2 ];

                    h4[0] -= 0.5*pix[4*((row - 1)* img.width + col+0)+0 ];
                    h4[1] -= 0.5*pix[4*((row - 1)* img.width + col+0)+1 ];
                    h4[2] -= 0.5*pix[4*((row - 1)* img.width + col+0)+2 ];

                    //Fifth Sobel
                    h5[0] = 0.5*pix[4*((row + 1)* img.width + col-1)+0 ];
                    h5[1] = 0.5*pix[4*((row + 1)* img.width + col-1)+1 ];
                    h5[2] = 0.5*pix[4*((row + 1)* img.width + col-1)+2 ];

                    h5[0] += 1*pix[4*((row + 1)* img.width + col-0)+0 ];
                    h5[1] += 1*pix[4*((row + 1)* img.width + col-0)+1 ];
                    h5[2] += 1*pix[4*((row + 1)* img.width + col-0)+2 ];

                    h5[0] += 0.5*pix[4*((row + 1)* img.width + col+1)+0 ];
                    h5[1] += 0.5*pix[4*((row + 1)* img.width + col+1)+1 ];
                    h5[2] += pix[4*((row + 1)* img.width + col+1)+2 ];

                    h5[0] -= 0.5*pix[4*((row - 1)* img.width + col-1)+0 ];
                    h5[1] -= 0.5*pix[4*((row - 1)* img.width + col-1)+1 ];
                    h5[2] -= 0.5*pix[4*((row - 1)* img.width + col-1)+2 ];

                    h5[0] -= 1*pix[4*((row - 1)* img.width + col-0)+0 ];
                    h5[1] -= 1*pix[4*((row - 1)* img.width + col-0)+1 ];
                    h5[2] -= 1*pix[4*((row - 1)* img.width + col-0)+2 ];

                    h5[0] -= 0.5*pix[4*((row - 1)* img.width + col+1)+0 ];
                    h5[1] -= 0.5*pix[4*((row - 1)* img.width + col+1)+1 ];
                    h5[2] -= 0.5*pix[4*((row - 1)* img.width + col+1)+2 ];

                    //Sixth Sobel
                    h6[0] = 0.5*pix[4*((row + 1)* img.width + col-0)+0 ];
                    h6[1] = 0.5*pix[4*((row + 1)* img.width + col-0)+1 ];
                    h6[2] = 0.5*pix[4*((row + 1)* img.width + col-0)+2 ];

                    h6[0] += 1*pix[4*((row + 1)* img.width + col-1)+0 ];
                    h6[1] += 1*pix[4*((row + 1)* img.width + col-1)+1 ];
                    h6[2] += 1*pix[4*((row + 1)* img.width + col-1)+2 ];

                    h6[0] += 0.5*pix[4*((row - 0)* img.width + col-1)+0 ];
                    h6[1] += 0.5*pix[4*((row - 0)* img.width + col-1)+1 ];
                    h6[2] += 0.5*pix[4*((row - 0)* img.width + col-1)+2 ];

                    h6[0] -= 0.5*pix[4*((row - 1)* img.width + col-0)+0 ];
                    h6[1] -= 0.5*pix[4*((row - 1)* img.width + col-0)+1 ];
                    h6[2] -= 0.5*pix[4*((row - 1)* img.width + col-0)+2 ];

                    h6[0] -= 1*pix[4*((row - 1)* img.width + col+1)+0 ];
                    h6[1] -= 1*pix[4*((row - 1)* img.width + col+1)+1 ];
                    h6[2] -= 1*pix[4*((row - 1)* img.width + col+1)+2 ];

                    h6[0] -= 0.5*pix[4*((row + 0)* img.width + col+1)+0 ];
                    h6[1] -= 0.5*pix[4*((row + 0)* img.width + col+1)+1 ];
                    h6[2] -= 0.5*pix[4*((row + 0)* img.width + col+1)+2 ];

                    //Seventh Sobel
                    h7[0] = 0.5*pix[4*((row - 1)* img.width + col-1)+0 ];
                    h7[1] = 0.5*pix[4*((row - 1)* img.width + col-1)+1 ];
                    h7[2] = 0.5*pix[4*((row - 1)* img.width + col-1)+2 ];

                    h7[0] += 1*pix[4*((row - 0)* img.width + col-1)+0 ];
                    h7[1] += 1*pix[4*((row - 0)* img.width + col-1)+1 ];
                    h7[2] += 1*pix[4*((row - 0)* img.width + col-1)+2 ];

                    h7[0] += 0.5*pix[4*((row + 1)* img.width + col-1)+0 ];
                    h7[1] += 0.5*pix[4*((row + 1)* img.width + col-1)+1 ];
                    h7[2] += 0.5*pix[4*((row + 1)* img.width + col-1)+2 ];

                    h7[0] -= 0.5*pix[4*((row - 1)* img.width + col+1)+0 ];
                    h7[1] -= 0.5*pix[4*((row - 1)* img.width + col+1)+1 ];
                    h7[2] -= 0.5*pix[4*((row - 1)* img.width + col+1)+2 ];

                    h7[0] -= 1*pix[4*((row + 0)* img.width + col+1)+0 ];
                    h7[1] -= 1*pix[4*((row + 0)* img.width + col+1)+1 ];
                    h7[2] -= 1*pix[4*((row + 0)* img.width + col+1)+2 ];

                    h7[0] -= 0.5*pix[4*((row + 1)* img.width + col+1)+0 ];
                    h7[1] -= 0.5*pix[4*((row + 1)* img.width + col+1)+1 ];
                    h7[2] -= 0.5*pix[4*((row + 1)* img.width + col+1)+2 ];

                    //Eigth Sobel
                    h8[0] = 0.5*pix[4*((row - 0)* img.width + col-1)+0 ];
                    h8[1] = 0.5*pix[4*((row - 0)* img.width + col-1)+1 ];
                    h8[2] = 0.5*pix[4*((row - 0)* img.width + col-1)+2 ];

                    h8[0] += 1*pix[4*((row - 1)* img.width + col-1)+0 ];
                    h8[1] += 1*pix[4*((row - 1)* img.width + col-1)+1 ];
                    h8[2] += 1*pix[4*((row - 1)* img.width + col-1)+2 ];

                    h8[0] += 0.5*pix[4*((row - 1)* img.width + col+0)+0 ];
                    h8[1] += 0.5*pix[4*((row - 1)* img.width + col+0)+1 ];
                    h8[2] += 0.5*pix[4*((row - 1)* img.width + col+0)+2 ];

                    h8[0] -= 0.5*pix[4*((row + 0)* img.width + col+1)+0 ];
                    h8[1] -= 0.5*pix[4*((row + 0)* img.width + col+1)+1 ];
                    h8[2] -= 0.5*pix[4*((row + 0)* img.width + col+1)+2 ];

                    h8[0] -= 1*pix[4*((row + 1)* img.width + col+1)+0 ];
                    h8[1] -= 1*pix[4*((row + 1)* img.width + col+1)+1 ];
                    h8[2] -= 1*pix[4*((row + 1)* img.width + col+1)+2 ];

                    h8[0] -= 0.5*pix[4*((row + 1)* img.width + col+0)+0 ];
                    h8[1] -= 0.5*pix[4*((row + 1)* img.width + col+0)+1 ];
                    h8[2] -= 0.5*pix[4*((row + 1)* img.width + col+0)+2 ];


                    val = getMaxSobel(h1,h2,h3,h4,h5,h6,h7,h8);

                    altpix[4*(row*rowSize + col) ] = val[0];
                    altpix[4*(row*rowSize + col)+1 ] =  val[1];
                    altpix[4*(row*rowSize + col)+2 ] =  val[2];
                    altpix[4*(row*rowSize + col)+3 ] =  val[3];


                };

            };

        };
        
        gl.putImageData(altImg,zerocanx / 2, zerocany / 2);

    }
    </code>
    </pre>

    <p></p>

    <br/>
    <a href="http://xksteven.com/">&lt;&lt; Back to Lesson 1</a><br />
</body>

</html>
